<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multiplayer Trivia Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    h2 {
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 5px;
    }
    #question {
      font-weight: bold;
      margin-top: 20px;
    }
    #options button {
      display: block;
      width: 100%;
      margin: 5px 0;
    }
    #log {
      white-space: pre-line;
      background: #eee;
      padding: 10px;
      margin-top: 20px;
      border-radius: 5px;
      height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>Multiplayer Trivia Game</h2>

  <label>Room: <input id="room" value="room1" /></label><br/>
  <label>Username: <input id="username" value="Player1" /></label><br/>
  <button onclick="connectWS()">Connect</button>
  <button onclick="startGame()">Start Game</button>

  <div id="question"></div>
  <div id="options"></div>
  <div id="log"></div>

  <script>
    let ws = null;

    function connectWS() {
      const room = document.getElementById("room").value;
      const username = document.getElementById("username").value;
      const host = location.host;  // uses same domain as backend
      const url = `ws://${host}/ws/${room}/${username}`;
      
      ws = new WebSocket(url);

      ws.onopen = () => log("âœ… Connected to server.");
      ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);

        if (msg.event === "message") {
          log("ðŸ—£ " + msg.data);
        } else if (msg.event === "new_question") {
          showQuestion(msg);
        } else if (msg.result) {
          log("ðŸ“ Your answer is " + msg.result.toUpperCase());
        } else if (msg.event === "game_over") {
          log("ðŸ Game Over!");
          msg.leaderboard.forEach(([name, score], i) =>
            log(`${i + 1}. ${name}: ${score} pts`)
          );
        }
      };

      ws.onclose = () => log("ðŸ”Œ Disconnected from server.");
      ws.onerror = () => log("âŒ WebSocket error.");
    }

    function startGame() {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({ action: "start_game" }));
      } else {
        log("âš ï¸ Connect to server first.");
      }
    }

    function showQuestion(data) {
      document.getElementById("question").textContent = data.question;
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      data.options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.textContent = option;
        btn.onclick = () => {
          ws.send(JSON.stringify({ action: "answer", answer: index }));
        };
        optionsDiv.appendChild(btn);
      });
    }

    function log(message) {
      const logDiv = document.getElementById("log");
      logDiv.textContent += message + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }
  </script>
</body>
</html>
